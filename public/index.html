<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Moko See Moko Do — Proof of Breath</title>
  <meta name="description" content="Moko See Moko Do / Ngā Wai o Rua — a living whare in code and carving. Every cut a law, every chip a Tiki.">

  <link rel="apple-touch-icon" href="assets/apple-touch-icon.png" sizes="180x180" />
  <link rel="icon" href="assets/favicon.png" type="image/png" />

  <style>
    :root{
      --pad:clamp(16px,3vw,40px);
      --gap:clamp(12px,2.2vw,28px);
      --glow:0 0 0 rgba(255,255,255,0), 0 0 24px rgba(103,187,255,.18), 0 0 64px rgba(103,187,255,.12);
      --max:1100px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:#0b0b0c;
      color:#e9ecef;
      font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial;
      -webkit-font-smoothing:antialiased;
    }

    header,footer{padding:var(--pad)}
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:var(--gap);
    }
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      text-decoration:none;
      color:inherit;
    }
    .brand__mark{
      inline-size:28px;
      block-size:28px;
      border-radius:7px;
      background:radial-gradient(60% 60% at 40% 40%,#2f3b46,#121315);
      box-shadow:var(--glow);
    }
    .brand__name{font-weight:600;letter-spacing:.02em}
    .links{
      display:flex;
      gap:14px;
      flex-wrap:wrap;
    }
    .links a{
      color:inherit;
      text-decoration:none;
      border-bottom:1px dotted rgba(148,163,184,.5);
      font-size:14px;
    }
    .links a:hover{
      color:#e2e8f0;
      border-bottom-color:#e2e8f0;
    }

    /* PARE banner */
    .pare-banner{
      padding:clamp(12px,2.4vw,24px) var(--pad) 0;
      display:grid;
      place-items:center;
    }
    .pare-banner img{
      display:block;
      max-width:min(1100px,92vw);
      width:100%;
      opacity:.98;
      filter: drop-shadow(0 0 24px rgba(103,187,255,.18))
              drop-shadow(0 0 64px rgba(103,187,255,.12));
    }
    .pare-fallback{
      width:100%;
      max-width:min(1100px,92vw);
      height:64px;
      border-radius:18px;
      background:
        radial-gradient(60% 60% at 50% 50%, rgba(103,187,255,.22), rgba(103,187,255,.08) 60%, rgba(0,0,0,0) 70%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      box-shadow: 0 0 0 1px rgba(255,255,255,.06) inset, var(--glow);
    }

    /* HERO (video only) */
    .hero{position:relative;background:#000;}
    .hero__wrap{position:relative;width:100%;height:auto;overflow:hidden}
    video#hero{
      display:block;
      width:100%;
      height:auto;
      object-fit:cover;
      object-position:center;
      background:#000;
    }
    .vignette{
      position:absolute;
      inset:0;
      pointer-events:none;
      background:radial-gradient(100% 120% at 50% 50%, rgba(0,0,0,0) 55%, rgba(0,0,0,.25) 90%);
    }

    /* Blink overlay */
    #blink{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      background:#000;
      z-index:2;
      transition:opacity .35s ease;
      cursor:pointer;
    }
    #blink.fade{opacity:0}
    #blink img{
      max-width:min(80%,520px);
      opacity:.9;
    }

    /* Generic section wrapper */
    main{padding-bottom:40px;}
    section{scroll-margin-top:72px;}

    .intro,
    .highlights,
    .engine,
    .contact-section{
      padding:clamp(20px,5vw,60px) var(--pad) 0;
    }
    .intro__inner,
    .highlights__inner,
    .engine__inner,
    .contact__inner{
      max-width:var(--max);
      margin:0 auto;
    }

    /* Intro section */
    .intro__inner{text-align:center}
    h1{
      font-size:clamp(28px,5.6vw,72px);
      line-height:1.02;
      margin:.2em 0 .2em;
    }
    .subtitle{
      font-size:clamp(16px,2.6vw,22px);
      color:#cbd5e1;
      margin:0 auto;
      max-width:68ch;
    }
    .yt-links{
      margin:12px auto 0;
      text-align:center;
      opacity:.95;
    }
    .yt-links a{
      color:#e2e8f0;
      text-decoration:underline;
      text-underline-offset:2px;
      font-size:14px;
    }
    .yt-links a:hover{text-decoration:none}

    /* Highlights (three cards) */
    .highlights{padding-top:clamp(18px,3vw,40px);}
    .cards{
      display:grid;
      grid-template-columns:repeat(3,minmax(0,1fr));
      gap:clamp(10px,1.6vw,16px);
    }
    .card{
      position:relative;
      border-radius:18px;
      padding:clamp(14px,2.2vw,20px);
      background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.08);
      box-shadow:0 0 0 1px rgba(255,255,255,.02) inset, var(--glow);
    }
    .card h3{
      margin:0 0 6px;
      font-weight:600;
      letter-spacing:.02em;
    }
    .card p{
      margin:0;
      color:#c9d1d9;
      font-size:clamp(14px,1.8vw,16px);
    }

    /* Shared heading style for deeper sections */
    .section-heading{
      margin-bottom:18px;
      text-align:left;
    }
    .section-heading h2{
      margin:0 0 6px;
      font-size:clamp(20px,3vw,26px);
      letter-spacing:.08em;
      text-transform:uppercase;
    }
    .section-heading p{
      margin:0;
      font-size:14px;
      color:#cbd5e1;
    }

    /* Engine / AEIOU */
    .engine-grid{
      display:grid;
      grid-template-columns:repeat(5,minmax(0,1fr));
      gap:clamp(10px,1.4vw,14px);
    }
    .engine-card h3{
      font-size:18px;
      margin:0 0 4px;
      letter-spacing:.1em;
      text-transform:uppercase;
    }
    .engine-tag{
      margin:0 0 8px;
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.14em;
      color:#94a3b8;
    }
    .engine-card p{
      margin:0;
      font-size:13px;
      color:#cbd5e1;
    }

    /* Contact */
    .contact-layout{
      display:grid;
      grid-template-columns:minmax(0,1.4fr) minmax(0,1fr);
      gap:clamp(18px,3vw,28px);
    }
    .contact-layout p{
      font-size:14px;
      color:#e5e7eb;
      margin:0 0 10px;
    }

    /* Gate 1 — Hei Rata viewer */
    #gate1-section{
      padding:clamp(20px,5vw,60px) var(--pad) 0;
    }
    #gate1-section-inner{
      max-width:var(--max);
      margin:0 auto;
    }
    #gate1-section h2{
      margin:0 0 8px;
      font-size:clamp(20px,3vw,26px);
      letter-spacing:.08em;
      text-transform:uppercase;
    }
    #gate1-section p{
      margin:0 0 16px;
      font-size:14px;
      color:#cbd5e1;
      max-width:70ch;
    }
    .model-shell{position:relative;}
    model-viewer.hei-rata-viewer{
      width:100%;
      height:500px;
      background:#050505;
      border-radius:24px;
      outline:none;
      box-shadow:var(--glow);
    }
    @media (max-width:768px){
      model-viewer.hei-rata-viewer{
        height:360px;
      }
    }
    .ar-button{
      border-radius:999px;
      border:1px solid rgba(148,163,184,.8);
      background:rgba(15,23,42,.9);
      color:#e5e7eb;
      font-size:12px;
      padding:6px 14px;
      display:inline-flex;
      align-items:center;
      gap:6px;
      cursor:pointer;
      position:absolute;
      bottom:16px;
      right:16px;
      box-shadow:0 0 0 1px rgba(15,23,42,.6),var(--glow);
    }
    .ar-button:hover{
      border-color:#e5e7eb;
      background:rgba(15,23,42,1);
    }
    .ar-button-icon{
      width:14px;
      height:14px;
      border-radius:4px;
      border:1px solid rgba(148,163,184,.8);
      display:inline-block;
      box-shadow:inset 0 0 0 1px rgba(15,23,42,.9);
    }
    .ar-note{
      margin:8px 0 0;
      font-size:11px;
      color:#9ca3af;
    }

    /* Gate 1 → Gate 2 button */
    .gate2-button{
      display:inline-flex;
      align-items:center;
      gap:6px;
      margin:0 0 12px;
      padding:6px 14px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.6);
      background:rgba(15,23,42,.8);
      color:#e5e7eb;
      font-size:13px;
      cursor:pointer;
    }
    .gate2-button:hover{
      border-color:#e5e7eb;
      background:rgba(15,23,42,.95);
    }

    /* Gate 2 — Inside the Grain */
    .gate2{
      padding:clamp(20px,5vw,60px) var(--pad) 0;
    }
    .gate2__inner{
      max-width:var(--max);
      margin:0 auto;
    }
    .gate2__inner h2{
      margin:0 0 8px;
      font-size:clamp(20px,3vw,26px);
      letter-spacing:.08em;
      text-transform:uppercase;
    }
    .gate2__intro{
      margin:0 0 18px;
      font-size:14px;
      color:#cbd5e1;
      max-width:70ch;
    }
    .gate2-grid{
      display:grid;
      grid-template-columns:repeat(3,minmax(0,1fr));
      gap:clamp(10px,1.6vw,16px);
    }
    .gate2-card h3{
      font-size:16px;
    }
    @media (max-width:900px){
      .gate2-grid{
        grid-template-columns:1fr;
      }
    }

    /* Gate 3 — Evidence Realm */
    .gate3{
      padding:clamp(20px,5vw,60px) var(--pad) 0;
    }
    .gate3__inner{
      max-width:var(--max);
      margin:0 auto;
    }
    .gate3__inner h2{
      margin:0 0 8px;
      font-size:clamp(20px,3vw,26px);
      letter-spacing:.08em;
      text-transform:uppercase;
    }
    .gate3__intro{
      margin:0 0 18px;
      font-size:14px;
      color:#cbd5e1;
      max-width:70ch;
    }
    .gate3-grid{
      display:grid;
      grid-template-columns:repeat(3,minmax(0,1fr));
      gap:clamp(10px,1.6vw,16px);
      margin-bottom:18px;
    }
    .gate3-card h3{
      font-size:16px;
    }
    .gate3-chip{
      border-radius:18px;
      padding:12px 14px 14px;
      background:radial-gradient(circle at top left,#020617,#020617);
      border:1px solid rgba(148,163,184,.6);
      box-shadow:var(--glow);
      font-size:12px;
    }
    .gate3-chip__id{
      font-size:11px;
      color:#9ca3af;
      margin-bottom:4px;
    }
    .gate3-chip__title{
      font-size:13px;
      font-weight:600;
      margin-bottom:4px;
    }
    .gate3-chip__meta{
      font-size:11px;
      color:#cbd5e1;
      margin-bottom:4px;
    }
    .gate3-chip__summary{
      font-size:12px;
      color:#e5e7eb;
      margin:0;
    }

    /* Gate 4 — The Breath Wall (Shader) */
    .gate4{
      padding:clamp(20px,5vw,60px) var(--pad) 0;
    }
    .gate4__inner{
      max-width:var(--max);
      margin:0 auto;
    }
    .gate4__inner h2{
      margin:0 0 8px;
      font-size:clamp(20px,3vw,26px);
      letter-spacing:.08em;
      text-transform:uppercase;
    }
    .gate4__intro{
      margin:0 0 18px;
      font-size:14px;
      color:#cbd5e1;
      max-width:70ch;
    }
    .gate4-canvas-wrap{
      position:relative;
      width:100%;
      max-width:var(--max);
      margin:0 auto;
      border-radius:24px;
      overflow:hidden;
      box-shadow:var(--glow);
      background:#020617;
      aspect-ratio: 16 / 9;
    }
    #gate4-canvas{
      width:100%;
      height:100%;
      display:block;
    }
    .gate4-note{
      margin:10px 0 0;
      font-size:11px;
      color:#9ca3af;
    }

    footer{
      border-top:1px solid rgba(255,255,255,.08);
      background:linear-gradient(to top,rgba(255,255,255,.02),rgba(255,255,255,0));
    }
    .vision{
      max-width:var(--max);
      margin:0 auto;
    }
    .vision h2{
      font-size:18px;
      margin:0 0 8px;
      letter-spacing:.12em;
      text-transform:uppercase;
    }
    .vision p{
      margin:0;
      font-size:14px;
      color:#cbd5e1;
    }
    .footbar{
      margin-top:clamp(16px,2.4vw,24px);
      display:flex;
      gap:var(--gap);
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
      color:#94a3b8;
      font-size:14px;
    }

    @media (max-width:900px){
      .cards{grid-template-columns:1fr}
      .engine-grid{grid-template-columns:repeat(2,minmax(0,1fr));}
      .contact-layout{
        grid-template-columns:1fr;
      }
      .gate3-grid{
        grid-template-columns:1fr;
      }
    }
    @media (max-width:640px){
      header{flex-direction:column;align-items:flex-start}
      .links{justify-content:flex-start}
      .engine-grid{grid-template-columns:1fr;}
    }
  </style>

  <!-- model-viewer library for Gate 1 -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <!-- Three.js for Gate 4 shader wall -->
  <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
</head>
<body>
  <header>
    <a class="brand" href="#home" aria-label="Moko See, Moko Do home">
      <span class="brand__mark" aria-hidden="true"></span>
      <span class="brand__name">Moko See Moko Do</span>
    </a>
    <nav class="links" aria-label="Primary">
      <a href="#about">About / Engine</a>
      <a href="#evidence">Evidence</a>
      <a href="#gate4">Breath Wall</a>
      <a href="#contact">Contact</a>
    </nav>
  </header>

  <!-- PARE banner -->
  <div class="pare-banner" aria-label="Pare lintel">
    <img src="assets/pare.svg" alt="" onerror="this.style.display='none'">
    <div class="pare-fallback" aria-hidden="true"></div>
  </div>

  <!-- HERO video with karakia blink -->
  <section class="hero" id="home">
    <div class="hero__wrap">
      <div id="blink" role="img" aria-label="Karakia">
        <img src="assets/karakia_blink_poster.png" alt="">
      </div>
      <video id="hero"
             src="assets/MSMD_intro_loop_v1.mp4"
             autoplay muted loop playsinline preload="auto"
             poster="assets/karakia_blink_poster.png"
             aria-label="MSMD / Ngā Wai o Rua intro loop"></video>
      <div class="vignette" aria-hidden="true"></div>
    </div>
  </section>

  <main>
    <!-- Intro -->
    <section class="intro" aria-labelledby="intro-heading">
      <div class="intro__inner">
        <h1 id="intro-heading">Proof of Breath</h1>
        <p class="subtitle">
          A living whare in code and carving — doing &gt; talking.
          Watch the wall breathe, follow the ledger, and see the chips turn into pattern.
        </p>

        <div class="yt-links">
          <a href="https://www.youtube.com/watch?v=VRCOLcx-ZZk" target="_blank" rel="noopener">Hara Mai te Toki</a> ·
          <a href="https://youtube.com/shorts/PfaqI8ED13I" target="_blank" rel="noopener">Ngāo Pae — Teaser (Short)</a> ·
          <a href="https://www.youtube.com/channel/UCFwfkTNkuu0EBbUAlhhNBwA/" target="_blank" rel="noopener">MSMD Channel</a>
        </div>
      </div>
    </section>

    <!-- Quick highlights strip -->
    <section class="highlights" aria-label="Highlights">
      <div class="highlights__inner">
        <div class="cards">
          <article class="card">
            <h3>Live Wall</h3>
            <p>60-second loop, LED-safe glow, compositor-sealed. Breathing plane; edges anchored.</p>
          </article>
          <article class="card">
            <h3>Whiro Ledger</h3>
            <p>Daily chips logged. Evidence before edge; one change per pass.</p>
          </article>
          <article class="card">
            <h3>Kaupapa</h3>
            <p>He toi whakairo, he mana tangata. Mind = stone, Action = chisel, Voice = resonance.</p>
          </article>
        </div>
      </div>
    </section>

    <!-- Gate 1 — Hei Rata Digital Taonga -->
    <section id="gate1-section" aria-labelledby="gate1-heading">
      <div id="gate1-section-inner">
        <h2 id="gate1-heading">Gate 1 — Hei Rata Digital Taonga</h2>
        <p>
          This hei rata was carved in living rata and then scanned with the Kiri engine.
          The 3D twin here is a digital taonga — proof that carving law can travel through
          light and code without losing its mana. Rotate, zoom, and sit with the grain.
        </p>

        <button type="button" class="gate2-button" data-target="#gate2-section">
          Enter Gate 2 — Inside the Grain
        </button>

        <div class="model-shell">
          <model-viewer
            id="gate1-viewer"
            class="hei-rata-viewer"
            src="assets/hei_rata_gate1_v1.glb"
            alt="Hei Rata digital taonga"
            camera-controls
            auto-rotate
            auto-rotate-delay="4000"
            interaction-prompt="auto"
            shadow-intensity="0.9"
            exposure="1.1"
            camera-orbit="-45deg 25deg 2.5m"
            field-of-view="35deg"
            ar
            ar-modes="webxr scene-viewer quick-look"
            ar-placement="floor"
            ar-scale="fixed">

            <button slot="ar-button" class="ar-button">
              <span class="ar-button-icon" aria-hidden="true"></span>
              <span>View hei rata in your space</span>
            </button>
          </model-viewer>
        </div>
        <p class="ar-note">
          On a phone, use “View hei rata in your space” to place the taonga on the floor or a table and walk around it.
        </p>
      </div>
    </section>

    <!-- Gate 2 — Inside the Grain -->
    <section id="gate2-section" aria-labelledby="gate2-heading" class="gate2">
      <div class="gate2__inner">
        <h2 id="gate2-heading">Gate 2 — Inside the Grain</h2>
        <p class="gate2__intro">
          Stepping through the hei rata brings you into the grain itself — the law behind the surface.
          This gate holds the memory logic of the taonga: kape rua, chip and Tiki, strike and echo.
        </p>

        <div class="cards gate2-grid">
          <article class="card gate2-card">
            <h3>Kape Rua — The Footprint Law</h3>
            <p>
              Every hollow in the scan is kape rua — motion leaving memory.
              The concave pockets in the hei rata are where the tool’s force became story.
            </p>
          </article>

          <article class="card gate2-card">
            <h3>Chip → Tiki</h3>
            <p>
              Each chisel strike became a chip; each chip became a Tiki once logged.
              The digital scan is the macro-Tiki — a single record holding all those chips at once.
            </p>
          </article>

          <article class="card gate2-card">
            <h3>Light as Whakapapa</h3>
            <p>
              In this gate the light is the storyteller.
              The breathing exposure marks time passing over the surface — Proof-of-Breath made visible.
            </p>
          </article>
        </div>
      </div>
    </section>

    <!-- Gate 3 — Evidence Realm -->
    <section id="evidence" aria-labelledby="gate3-heading" class="gate3">
      <div class="gate3__inner">
        <h2 id="gate3-heading">Gate 3 — Evidence Realm (Whiro Ledger)</h2>
        <p class="gate3__intro">
          This gate holds the receipts behind the kaupapa. Every action leaves a chip, every chip becomes a Tiki,
          and together they form the living landscape of the whare.
        </p>

        <div class="cards gate3-grid">
          <article class="card gate3-card">
            <h3>Daily Chips</h3>
            <p>
              Small, honest entries captured in Whiro — one box at a time.
              Each chip proves that the mahi happened, in a real body, in real time.
            </p>
          </article>

          <article class="card gate3-card">
            <h3>Landscape of Mahi</h3>
            <p>
              Forest floor, hills, maunga, ridgelines, lightning.
              Chips stack into terrain so you can see where the kaupapa has truly walked.
            </p>
          </article>

          <article class="card gate3-card">
            <h3>Crown Receipts</h3>
            <p>
              When enough chips align, they seal into a Crown — fixed versions, hashed folders,
              and documents that protect the pattern for the mokopuna.
            </p>
          </article>
        </div>

        <div id="gate3-chip" class="gate3-chip" aria-live="polite">
          Loading a sample chip from the Whiro ledger&hellip;
        </div>
      </div>
    </section>

    <!-- Gate 4 — The Breath Wall (Shader) -->
    <section id="gate4" aria-labelledby="gate4-heading" class="gate4">
      <div class="gate4__inner">
        <h2 id="gate4-heading">Gate 4 — Te Pūkāea o te Manawa (The Breath Wall)</h2>
        <p class="gate4__intro">
          A live breathing plane driven by law, not footage. The centre rises and falls like a lung,
          while the edges stay anchored — a wall that remembers its frame even as it moves.
        </p>

        <div class="gate4-canvas-wrap">
          <canvas id="gate4-canvas"></canvas>
        </div>
        <p class="gate4-note">
          Shader Scope 1 — time-driven breath with edge anchor + firefly particles.
          Later, the depth of the breath can follow real Whiro chips and Ruaumoko Index.
        </p>
      </div>
    </section>

    <!-- AEIOU ENGINE -->
    <section class="engine" id="about" aria-labelledby="engine-heading">
      <div class="engine__inner">
        <div class="section-heading">
          <h2 id="engine-heading">The engine behind the whare</h2>
          <p>AEIOU — one breath, five roles.</p>
        </div>

        <div class="cards engine-grid">
          <article class="card engine-card">
            <h3>A</h3>
            <p class="engine-tag">WHY · Identity · Whakapapa</p>
            <p>
              To make spirit visible through action.
              Every movement is a cut; every cut is a promise to the mokopuna watching.
            </p>
          </article>

          <article class="card engine-card">
            <h3>E</h3>
            <p class="engine-tag">HOW · Kaupapa Engine</p>
            <p>
              Ruaumoko → Manaia → Tāne → Rongo.
              Feel first, choose through hands, act in rhythm, store as Tiki.
            </p>
          </article>

          <article class="card engine-card">
            <h3>I</h3>
            <p class="engine-tag">WHAT · Artefacts · Proof</p>
            <p>
              Pou, pare, waharoa, LED walls, geometry-node renders —
              each artefact is a receipt of balance between body, tool, and time.
            </p>
          </article>

          <article class="card engine-card">
            <h3>O</h3>
            <p class="engine-tag">WHO · People · Places</p>
            <p>
              Hokianga-nui-a-Kupe, Te Piiti Marae, the carvers, coders and mokopuna
              who stand inside this whare of work.
            </p>
          </article>

          <article class="card engine-card">
            <h3>U</h3>
            <p class="engine-tag">WHEN · Rhythm · Cycles</p>
            <p>
              Maramataka, Whiro ledger, crowns and chips.
              Time boxed by Māui so each cycle closes with a measurable Tiki — a complete breath.
            </p>
          </article>
        </div>
      </div>
    </section>

    <!-- CONTACT -->
    <section class="contact-section" id="contact" aria-labelledby="contact-heading">
      <div class="contact__inner">
        <div class="section-heading">
          <h2 id="contact-heading">Korero / Contact</h2>
          <p>For kaupapa-aligned collaboration only.</p>
        </div>

        <div class="contact-layout">
          <div>
            <p>
              If you feel the engine speaking to your own mahi — education, health, research,
              technology, or whenua-based projects — you can reach out directly.
            </p>
            <p>
              This is not a shop. It is a whare. Entry is through kaupapa, not consumption.
            </p>
          </div>
          <div>
            <p><strong>Email:</strong> <span>kiaora@mokoseemokodo.com</span></p>
            <p><strong>Location:</strong> Hokianga-nui-a-Kupe, Aotearoa</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <section class="vision" aria-labelledby="vision-heading">
      <h2 id="vision-heading">Vision</h2>
      <p>
        Anchor it so it can travel.
        A clean line from whare to web: carve, capture, and show the breath in motion
        so the kaupapa stands without us and for us.
      </p>
      <div class="footbar">
        <span>© <span id="y"></span> MSMD</span>
        <nav class="links" aria-label="Secondary">
          <a href="#about">About</a>
          <a href="#evidence">Evidence Strip</a>
          <a href="#gate4">Breath Wall</a>
          <a href="#contact">Contact</a>
        </nav>
      </div>
    </section>
  </footer>

  <script>
    const v = document.getElementById('hero');
    const blink = document.getElementById('blink');

    function tryPlay(){ v.play().catch(()=>{}); }
    v.addEventListener('loadeddata', tryPlay, { once:true });

    const holdMs = 600; // how long the karakia sits before fade (ms)

    function hideBlink(){
      blink.classList.add('fade');
      setTimeout(()=> blink.remove(), 350);
      tryPlay();
    }

    if (matchMedia('(prefers-reduced-motion: reduce)').matches) {
      hideBlink();
    } else {
      setTimeout(hideBlink, holdMs);
    }

    blink.addEventListener('click', hideBlink);

    document.getElementById('y').textContent = new Date().getFullYear();

    // --- Gate 1 breathing light (Proof-of-Breath v1.2) ---
    (function startGate1Breath() {
      const viewer = document.getElementById('gate1-viewer');
      if (!viewer) return;

      const baseExposure  = 1.1;
      const amplitude     = 0.35;
      const periodSeconds = 10;

      let startTime = null;

      function frame(timestamp) {
        if (!startTime) startTime = timestamp;
        const elapsed = (timestamp - startTime) / 1000; // seconds
        const phase   = (elapsed / periodSeconds) * 2 * Math.PI;
        const offset  = Math.sin(phase);
        const exposure = baseExposure + amplitude * offset;
        viewer.setAttribute('exposure', exposure.toFixed(3));
        requestAnimationFrame(frame);
      }

      requestAnimationFrame(frame);
    })();
    // --- End Gate 1 breathing light ---

    // --- Gate 2 navigation button (scroll to Inside the Grain) ---
	document.querySelectorAll('.gate2-button').forEach(btn => {
	  btn.addEventListener('click', () => {
		const target = btn.getAttribute('data-target');
		const el = document.querySelector(target);
		if (el) {
		  el.scrollIntoView({ behavior: 'smooth', block: 'start' });
		}
		if (window.msmdSetGateMode) {
		  window.msmdSetGateMode(2); // Gate 2 colours
		}
	  });
	});
	// --- End Gate 2 navigation ---
	// --- Top nav → gate colour mapping ---
	document.querySelectorAll('header .links a, footer .links a').forEach(link => {
	  link.addEventListener('click', () => {
		const href = link.getAttribute('href') || '';
		if (!window.msmdSetGateMode) return;

		if (href === '#evidence') {
		  window.msmdSetGateMode(3); // Gate 3 — Evidence Realm
		} else if (href === '#gate4') {
		  window.msmdSetGateMode(4); // Gate 4 — Breath Wall
		} else if (href === '#about') {
		  window.msmdSetGateMode(1); // Treat About/Engine as Gate 1 identity layer
		}
		// #contact leaves the current colour as-is
	  });
	});
	// --- End nav → gate colour mapping ---


    // --- Gate 3 live chip render ---
    (function loadGate3Chip() {
      const target = document.getElementById('gate3-chip');
      if (!target) return;

      fetch('JSON/gate3_sample_chip.json')
        .then(res => {
          if (!res.ok) throw new Error('Chip fetch failed');
          return res.json();
        })
        .then(chip => {
          const id    = chip.id || 'UNKNOWN_ID';
          const title = chip.title || 'Untitled chip';
          const date  = chip.date || 'No date';

          const artefactName = chip.artefact && chip.artefact.name
            ? chip.artefact.name
            : 'Unnamed artefact';

          const layer = chip.landscape && chip.landscape.layer
            ? chip.landscape.layer
            : 'unknown layer';

          const height = chip.landscape && chip.landscape.height != null
            ? chip.landscape.height
            : '?';

          const summary = chip.action && chip.action.summary
            ? chip.action.summary
            : 'No summary available.';

          target.innerHTML = `
            <div class="gate3-chip__id">${id} · ${date}</div>
            <div class="gate3-chip__title">${title}</div>
            <div class="gate3-chip__meta">
              Artefact: ${artefactName} · Landscape: ${layer} (height ${height})
            </div>
            <p class="gate3-chip__summary">${summary}</p>
          `;
        })
        .catch(() => {
          target.textContent = 'Chip unavailable — ledger is closed to the public right now.';
        });
    })();
    // --- End Gate 3 live chip render ---

    // --- Gate 4 shader wall (Scope 1: breath, edge anchor, particles, colour wheel, manu-follow) ---
	(function initGate4Shader(){
	  const canvas = document.getElementById('gate4-canvas');
	  if (!canvas || !window.THREE) return;

	  const renderer = new THREE.WebGLRenderer({
		canvas: canvas,
		antialias: true
	  });
	  renderer.setPixelRatio(window.devicePixelRatio || 1);

	  const scene = new THREE.Scene();
	  const camera = new THREE.OrthographicCamera(-1, 1, 1, -1, 0.1, 10);
	  camera.position.z = 1;

	  // --- Base wall geometry + shader ---
	  const wallGeometry = new THREE.PlaneGeometry(2, 2);

	  const wallVertexShader = `
		varying vec2 vUv;
		void main() {
		  vUv = uv;
		  gl_Position = vec4(position, 1.0);
		}
	  `;

	  const wallFragmentShader = `
		precision highp float;
		varying vec2 vUv;
		uniform float u_time;
		uniform vec3 u_glowColor;

		void main() {
		  vec2 uv = vUv;
		  vec2 centred = uv - 0.5;
		  float dist = length(centred);

		  float speed = 0.6;
		  float breath = 0.5 + 0.5 * sin(u_time * speed);

		  float edge = smoothstep(0.35, 0.8, dist);
		  float bulge = breath * (1.0 - edge);
		  float vignette = 1.0 - smoothstep(0.0, 0.9, dist);

		  vec3 base = vec3(0.01, 0.03, 0.06);
		  vec3 glow = u_glowColor;

		  float intensity = bulge * vignette;
		  vec3 color = base + glow * intensity;

		  gl_FragColor = vec4(color, 1.0);
		}
	  `;

	  const wallMaterial = new THREE.ShaderMaterial({
		uniforms: {
		  u_time:      { value: 0.0 },
		  u_glowColor: { value: new THREE.Color(0.20, 0.65, 1.00) } // default cyan
		},
		vertexShader: wallVertexShader,
		fragmentShader: wallFragmentShader
	  });

	  const wallMesh = new THREE.Mesh(wallGeometry, wallMaterial);
	  scene.add(wallMesh);

	  // --- Firefly particle layer (Scope 1.A) ---

	  const particleCount = 4000;
	  const positions = new Float32Array(particleCount * 3);
	  const offsets   = new Float32Array(particleCount * 3);

	  for (let i = 0; i < particleCount; i++) {
		const i3 = i * 3;

		const r = Math.random() * 1.2;
		const a = Math.random() * Math.PI * 2.0;

		const x = Math.cos(a) * r;
		const y = Math.sin(a) * r;
		const z = (Math.random() - 0.5) * 0.2;

		positions[i3 + 0] = x;
		positions[i3 + 1] = y;
		positions[i3 + 2] = z;

		offsets[i3 + 0] = Math.random() * 10.0;
		offsets[i3 + 1] = Math.random() * 10.0;
		offsets[i3 + 2] = Math.random() * 10.0;
	  }

	  const particleGeometry = new THREE.BufferGeometry();
	  particleGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
	  particleGeometry.setAttribute('aOffset',  new THREE.BufferAttribute(offsets, 3));

	  const particleVertexShader = `
		uniform float u_time;
		uniform float u_breathIntensity;
		uniform vec2  u_cursor;
		uniform float u_cursorInfluence;

		attribute vec3 aOffset;

		varying float vAlpha;

		void main() {
		  vec3 pos = position;

		  float t = u_time * 0.2 + aOffset.x;

		  // gentle orbital drift
		  pos.x += 0.1 * sin(t + aOffset.y);
		  pos.y += 0.1 * cos(t + aOffset.z);

		  float breath = 0.5 + 0.5 * sin(u_time * 0.8 + aOffset.x);
		  pos.z += (breath - 0.5) * 0.2 * u_breathIntensity;

		  // --- manu-follow: slight attraction toward cursor ---
		  // u_cursor is in [-1,1] space, same as plane
		  vec2 toCursor = u_cursor - pos.xy;
		  // soften pull with distance + breath
		  float dist = length(toCursor);
		  float pull = u_cursorInfluence * breath * smoothstep(1.2, 0.0, dist);
		  pos.xy += toCursor * pull;

		  vAlpha = 0.2 + 0.8 * breath;

		  gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
		  gl_PointSize = 2.5 + 2.0 * breath;
		}
	  `;

	  const particleFragmentShader = `
		precision highp float;
		varying float vAlpha;
		uniform vec3 u_particleColor;

		void main() {
		  vec2 coord = gl_PointCoord - 0.5;
		  float dist = length(coord);

		  float mask = smoothstep(0.5, 0.0, dist);

		  vec3 color = u_particleColor;
		  float alpha = vAlpha * mask;

		  gl_FragColor = vec4(color, alpha);
		}
	  `;

	  const particleMaterial = new THREE.ShaderMaterial({
		transparent: true,
		depthWrite: false,
		blending: THREE.AdditiveBlending,
		uniforms: {
		  u_time:            { value: 0.0 },
		  u_breathIntensity: { value: 1.0 },
		  u_particleColor:   { value: new THREE.Color(1.0, 0.7, 0.4) },
		  u_cursor:          { value: new THREE.Vector2(0.0, 0.0) },
		  u_cursorInfluence: { value: 0.35 } // how strongly manu follow you
		},
		vertexShader: particleVertexShader,
		fragmentShader: particleFragmentShader
	  });

	  const particlePoints = new THREE.Points(particleGeometry, particleMaterial);
	  scene.add(particlePoints);

	  // --- Gate colour wheel mapping ---

	  const gateColors = {
		1: {
		  glow:      new THREE.Color(1.0, 0.80, 0.45),
		  particles: new THREE.Color(1.0, 0.85, 0.55)
		},
		2: {
		  glow:      new THREE.Color(0.55, 0.95, 0.65),
		  particles: new THREE.Color(0.70, 1.00, 0.70)
		},
		3: {
		  glow:      new THREE.Color(0.30, 0.70, 1.00),
		  particles: new THREE.Color(0.60, 0.80, 1.00)
		},
		4: {
		  glow:      new THREE.Color(1.00, 0.55, 0.35),
		  particles: new THREE.Color(1.00, 0.70, 0.40)
		}
	  };

	  function setGateMode(gate){
		const cfg = gateColors[gate] || gateColors[4];
		wallMaterial.uniforms.u_glowColor.value.copy(cfg.glow);
		particleMaterial.uniforms.u_particleColor.value.copy(cfg.particles);
	  }

	  window.msmdSetGateMode = setGateMode;
	  setGateMode(4); // default Gate 4

	  // --- Pointer → u_cursor mapping (manu-follow) ---

	  const cursor = particleMaterial.uniforms.u_cursor.value;

	  function updateCursorFromEvent(ev){
		const rect = canvas.getBoundingClientRect();
		if (rect.width === 0 || rect.height === 0) return;

		const x = ((ev.clientX - rect.left) / rect.width) * 2 - 1;
		const y = -(((ev.clientY - rect.top) / rect.height) * 2 - 1);

		cursor.set(x, y);
	  }

	  canvas.addEventListener('pointermove', updateCursorFromEvent);
	  canvas.addEventListener('pointerdown', updateCursorFromEvent);

	  canvas.addEventListener('pointerleave', () => {
		cursor.set(0.0, 0.0); // return to centre when you leave
	  });

	  // --- Resize & animation loop ---

	  function resizeRendererToDisplaySize() {
		const width = canvas.clientWidth;
		const height = canvas.clientHeight;
		if (width === 0 || height === 0) return;
		renderer.setSize(width, height, false);
	  }

	  function animate(timestamp){
		const t = timestamp * 0.001;

		wallMaterial.uniforms.u_time.value = t;
		particleMaterial.uniforms.u_time.value = t;

		resizeRendererToDisplaySize();
		renderer.render(scene, camera);
		requestAnimationFrame(animate);
	  }

	  requestAnimationFrame(animate);

	  window.addEventListener('resize', () => {
		resizeRendererToDisplaySize();
	  });
	})();
	// --- End Gate 4 shader wall ---


  </script>
</body>
</html>
